# Рубцова М.Е., БПИ-218, ИДЗ 4, Вариант 14.

## Задание

В гостинице 10 номеров рассчитаны на одного человека и 15 номеров рассчитаны на двух человек. В гостиницу случайно приходят клиенты–дамы и клиенты–джентльмены, и конечно они могут провести ночь в номере только с представителем своего пола. Если для клиента не находится подходящего номера, он уходит искать ночлег в другое место. Клиенты порождаются динамически и уничтожаются при освобождении номера или уходе из гостиницы при невозможности поселиться. Создать приложение, моделирующее работу гостиницы. Каждого клиента реализовать в виде отдельного процесса. Гостиница — сервер. Каждого гостя реализовать в виде отдельного клиента, порождаемого вручную. Можно запустить скрипт, порождающий сразу множество гостей в фоновом режиме.
 
## Решение

Исходные файлы каждого решения расположены в папке с номером этого решения.\
Все решения соответствуют описанным в задании требованиям. Сценарий решений приведен ниже.

### Компиляция
```sh
gcc hotel.c -o hotel
```

```sh
gcc client.c -o client
```

### Порядок запуска
```sh
./hotel 127.0.0.1 8888
```

```sh
sh script.bash
```

### Сценарий решения

Есть разделяемая память, доступная для всех процессов. Доступ к ней блокируется с помощью семафора clients. В этой памяти - массиве чаров, хранится информация о занятости номеров отеля. Соответствие статуса номеров и числовых значений в массиве:\
а) свободен – 0,\
б) занят женщиной – 2,\
в) занят мужчиной – 3\
г) занят двумя женщинами – 4,\
д) занят двумя мужчинами – 6.\
Первые 15 номеров двуместные, оставшиеся 10 - одноместные.\
В цикле происходит подключение клиента к серверу через протокол UDP и создаются процессы-посетители, которые по одному получают доступ к номерам и заселяются, если это возможно (если невозможно, то происходит уничтожение процесса). Пол посетителя передается на сервер в сообщении от клиента. Исход процесса подбора комнаты отправляется обратно клиенту (0 - если комната не была найдена, иначе номер комнаты). Главный процесс-родитель после создания всех дочерних процессов 10 секунд ожидает ввод (можно просто Enter) в стандартный поток. Если пользователем что-то вводится, то все дочерние процессы убиваются (реализовано с помощью kill и игнорирования родительского потока). Если ввода нет, то родительский процесс дожидается завершения всех дочерних и работа программы завершается.

### Решение (4-5 баллов)
Информация о происходящем + служебные сообщения выводятся на сторонах сервера и  клиентов вперемешку с служебными сообщениями вроде "соединение было установлено".

### Примеры работы программы
Вывод на стороне сервера и клиентов.\
![Пример 1](https://github.com/acidnaya/OS_HW_4/blob/main/images/1.jpg)\
![Пример 2](https://github.com/acidnaya/OS_HW_4/blob/main/images/2.jpg)\

P.S. Если что-то не заработает, то надо закомментировать unlink_all() в main-функции hotel.c...\
PP.S. Если сервер не прекращает работу, то нужно повторно запустить скрипт, ему не хватило посетителей...
